{% extends 'base.html' %}

{% block content %}
<h1>문제 수정하기</h1>
<form id="problem-form" action="{% url 'reviews:update' form.instance.pk %}" method="post">
  {% csrf_token %}
  
  {% with form.url as url %}
  <div class="form-group">
    <label for="{{ url.id_for_label }}">{{ url.label }}</label>
    <input type="{{ url.field.widget.input_type }}" class="form-control" id="" placeholder="{{ url.label }}" name="{{ url.name }}" />
  </div>
  {% endwith %}

  {% with form.description as description %}
  <div class="form-group" style="display: none;">
    {# UI에 드러나지 않는 div입니다 #}
    <label for="{{ description.id_for_label }}">{{ description.label }}</label>
    <textarea id="{{ description.id_for_label }}" class="form-control" placeholder="{{ description.label }}" name="{{ description.name }}">{{ form.instance.description }}</textarea>
  </div>
  {% endwith %}
  
  {# ToastUI가 들어가는 div입니다 #}
  <div id="editor"></div>

  {% with form.tags as tags %}
  <div class="form-group">
    <label for="{{ tags.id_for_label }}">{{ tags.label }}</label>
    <input type="{{ tags.field.widget.input_type }}" class="form-control" id="" placeholder="{{ tags.label }}" name="{{ tags.name }}" />
  </div>
  {% endwith %}
  
  <button type="submit">문제 수정하기</button>
</form>
<script>
  // ToastUI 및 제출
  document.addEventListener('DOMContentLoaded', (event) => {
    const editorDiv = document.getElementById('editor');
    const reviewFormTextArea = document.querySelector('textarea')
    const editor = new toastui.Editor({
      el: editorDiv,
      height: '500px',
      initialEditType: 'markdown',
      previewStyle: 'vertical',
      initialValue: reviewFormTextArea.textContent,
    })
    const problemForm = document.getElementById('problem-form')
    problemForm.addEventListener('submit', (e) => {
      e.preventDefault()
      reviewFormTextArea.textContent = editor.getMarkdown()
      reviewForm.submit()
    });
  });
  // ToastUI 및 제출 끝
</script>
{% endblock content %}