{% extends 'base.html' %}

{% block content %}
<h1>리뷰 수정하기</h1>
<form id="review-form" action="{% url 'reviews:review_update' form.instance.problem.pk form.instance.pk %}" method="post">
  {% csrf_token %}
  
  {% with form.content as content %}
  <div class="form-group" style="display: none;">
    {# UI에 드러나지 않는 div입니다 #}
    <label for="{{ content.id_for_label }}">{{ content.label }}</label>
    <textarea id="{{ content.id_for_label }}" class="form-control" placeholder="{{ content.label }}" name="{{ content.name }}">{{ form.instance.content }}</textarea>
  </div>
  {% endwith %}
  
  {# ToastUI가 들어가는 div입니다 #}
  <div id="editor"></div>

  {% with form.tags as tags %}
  <div class="form-group">
    <label for="{{ tags.id_for_label }}">{{ tags.label }}</label>
    <input type="{{ tags.field.widget.input_type }}" class="form-control" id="" placeholder="{{ tags.label }}" name="{{ tags.name }}" />
  </div>
  {% endwith %}
  
  <button type="submit">리뷰 수정하기</button>
</form>
<script>
  // ToastUI 및 제출
  document.addEventListener('DOMContentLoaded', (event) => {
    const editorDiv = document.getElementById('editor');
    const reviewFormTextArea = document.querySelector('textarea')
    const editor = new toastui.Editor({
      el: editorDiv,
      height: '500px',
      initialEditType: 'markdown',
      previewStyle: 'vertical',
      initialValue: reviewFormTextArea.textContent,
    })
    const reviewForm = document.getElementById('review-form')
    reviewForm.addEventListener('submit', (e) => {
      e.preventDefault()
      reviewFormTextArea.textContent = editor.getMarkdown()
      reviewForm.submit()
    });
  });
  // ToastUI 및 제출 끝
</script>
{% endblock content %}